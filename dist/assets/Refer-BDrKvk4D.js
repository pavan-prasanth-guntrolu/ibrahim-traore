import{c as I,r as n,u as z,x as G,E as c,j as e,m as L,B as b}from"./index-UkIVRyTT.js";import{L as T,I as U}from"./label-DNRU1SRB.js";import{C as h,b as p,c as g,a as y}from"./card-YKzyoE8F.js";import{U as J}from"./users-BKrj_IKR.js";import{T as V}from"./trophy-i3kfzVAg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=I("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=I("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),te=()=>{const[m,q]=n.useState(""),[v,A]=n.useState([]),[Y,B]=n.useState(!0),[x,C]=n.useState(""),[j,R]=n.useState(!1),[D,P]=n.useState(""),[_,E]=n.useState([]),{user:a}=z(),{toast:s}=G();n.useEffect(()=>{a&&(k(),$())},[a]);const k=async()=>{try{const{data:r,error:t}=await c.from("registrations").select(`
          referral_code,
          id,
          referred_by,
          referrer:registrations!referred_by(referral_code)
        `).eq("user_id",a.id).single();if(t&&t.code!=="PGRST116")throw t;if(r){R(!0),q(r.referral_code),r.referrer&&r.referrer.referral_code&&(P(r.referrer.referral_code),C(r.referrer.referral_code));const{data:o,error:i}=await c.from("registrations").select("fullName, email, created_at").eq("referred_by",r.id);if(i)throw i;A(o||[])}else R(!1)}catch(r){console.error("Error fetching referral data:",r),s({title:"Error",description:"Failed to load referral data.",variant:"destructive"})}finally{B(!1)}},$=async()=>{try{const{data:r,error:t}=await c.from("registrations").select("referred_by").not("referred_by","is",null);if(t)throw t;const o=[...new Set(r.map(l=>l.referred_by))];if(o.length===0){E([]);return}const{data:i,error:f}=await c.from("registrations").select("id, fullName, email").in("id",o);if(f)throw f;const N={};i.forEach(l=>{N[l.id]={fullName:l.fullName,email:l.email}});const u={};r.forEach(l=>{var S,F;const d=l.referred_by;u[d]||(u[d]={id:d,count:0,fullName:((S=N[d])==null?void 0:S.fullName)||"Unknown",email:((F=N[d])==null?void 0:F.email)||"Unknown"}),u[d].count++});const Q=Object.values(u).sort((l,d)=>d.count-l.count).slice(0,5);E(Q)}catch(r){console.error("Error fetching leaderboard:",r)}},H=()=>{navigator.clipboard.writeText(m),s({title:"Copied!",description:"Referral code copied to clipboard."})},M=()=>{const r=`${window.location.origin}/register?ref=${m}`;navigator.share?navigator.share({title:"Join Qiskit Fall Fest 2025",text:"Use my referral code to register!",url:r}):(navigator.clipboard.writeText(r),s({title:"Link Copied!",description:"Referral link copied to clipboard."}))},O=async()=>{var r;if(!x.trim()){s({title:"Error",description:"Please enter a referral code.",variant:"destructive"});return}if(x.trim()===m){s({title:"Invalid Code",description:"You cannot use your own referral code.",variant:"destructive"});return}try{let t=null;const{data:o}=await c.from("registrations").select("id, user_id").eq("referral_code",x.trim()).single();if(o){if(o.user_id===a.id){s({title:"Invalid Code",description:"You cannot use your own referral code.",variant:"destructive"});return}t=o.id}else{s({title:"Invalid Code",description:"The referral code you entered is invalid.",variant:"destructive"});return}if(j){const{error:i}=await c.from("registrations").update({referred_by:t}).eq("user_id",a.id);if(i)throw i}else{const i=btoa(a.id).substring(0,8),{error:f}=await c.from("registrations").insert([{user_id:a.id,fullName:((r=a.user_metadata)==null?void 0:r.full_name)||a.email,email:a.email,referral_code:i,referred_by:t}]);if(f)throw f}s({title:"Referral Applied!",description:"Your referral code has been applied successfully."}),k()}catch(t){console.error("Error applying referral code:",t),s({title:"Error",description:"Failed to apply referral code. Please try again.",variant:"destructive"})}};return Y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Loading..."})]})}):e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen bg-background py-20",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs(L.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold font-poppins mb-4",children:"Refer & Earn"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Share your referral code and invite friends to join Qiskit Fall Fest 2025"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12",children:[e.jsxs(h,{className:"glass-card border border-white/10",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-primary"}),"Friend's Referral Code"]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"friendReferralCode",children:"Referral Code"}),e.jsx(U,{id:"friendReferralCode",type:"text",value:x,onChange:r=>C(r.target.value),placeholder:"Enter your friend's referral code",className:"font-mono"})]}),e.jsx(b,{onClick:O,className:"w-full",children:"Apply/Update Referral Code"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:D?"Update your friend's referral code if needed.":"Enter a referral code from a friend to earn rewards!"})]})]}),e.jsxs(h,{className:"glass-card border border-white/10",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-primary"}),"Your Referral Code"]})}),e.jsx(y,{className:"space-y-4",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(T,{children:"Referral Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{value:m,readOnly:!0,className:"font-mono"}),e.jsx(b,{onClick:H,variant:"outline",children:e.jsx(K,{className:"h-4 w-4"})})]})]}),e.jsxs(b,{onClick:M,className:"w-full",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Share Referral Link"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share this code with friends during registration to earn rewards!"})]}):e.jsx("p",{className:"text-muted-foreground",children:"Apply a friend's referral code first to get your own referral code."})})]}),e.jsxs(h,{className:"glass-card border border-white/10",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(J,{className:"h-5 w-5 mr-2 text-primary"}),"People You've Referred"]})}),e.jsx(y,{children:j?v.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No referrals yet. Start sharing!"}):e.jsx("div",{className:"space-y-3",children:v.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()})]},t))}):e.jsx("p",{className:"text-muted-foreground",children:"Apply a friend's referral code to start referring others."})})]})]}),e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(h,{className:"glass-card border border-white/10",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-center",children:[e.jsx(V,{className:"h-6 w-6 mr-3 text-primary"}),"Top Referrers Leaderboard"]})}),e.jsx(y,{children:_.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"No referrals yet. Be the first!"}):e.jsx("div",{className:"space-y-4",children:_.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-2xl font-bold min-w-[40px] ${t===0?"text-yellow-500":t===1?"text-gray-400":t===2?"text-amber-600":"text-muted-foreground"}`,children:["#",t+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:r.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-bold text-primary",children:r.count}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["referral",r.count!==1?"s":""]})]})]},r.id))})})]})})]})})})};export{te as default};
